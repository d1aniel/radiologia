<p-toast></p-toast>

<div class="mx-auto w-full max-w-[880px] rounded-xl bg-white p-4 sm:p-6 shadow-sm">
  <h2 class="mb-4 text-lg font-semibold text-slate-800">Subir Imagen de Estudio</h2>

  <form [formGroup]="form" (ngSubmit)="submit()" class="grid grid-cols-12 gap-3 text-sm">

    <!-- ESTUDIO -->
    <div class="col-span-12 md:col-span-6">
      <label for="estudioId" class="block mb-1 text-sm font-medium text-slate-700">Estudio</label>
      <p-select
        inputId="estudioId"
        formControlName="estudioId"
        [options]="estudios"
        optionLabel="label"
        optionValue="value"
        placeholder="Seleccione..."
        class="w-full">
      </p-select>
      <small class="block mt-1 text-xs text-red-600"
             *ngIf="f['estudioId'].touched && f['estudioId'].errors?.['required']">
        El estudio es obligatorio.
      </small>
    </div>

    <!-- TIPO -->
    <div class="col-span-12 md:col-span-6">
      <label for="tipo" class="block mb-1 text-sm font-medium text-slate-700">Tipo</label>
      <p-select
        inputId="tipo"
        formControlName="tipo"
        [options]="tiposImagen"
        optionLabel="label"
        optionValue="value"
        placeholder="Seleccione..."
        class="w-full">
      </p-select>
      <small class="block mt-1 text-xs text-red-600"
             *ngIf="f['tipo'].touched && f['tipo'].errors?.['required']">
        El tipo es obligatorio.
      </small>
    </div>

    <!-- ARCHIVO -->
    <div class="col-span-12">
      <label for="archivo" class="block mb-1 text-sm font-medium text-slate-700">Archivo</label>
      <input id="archivo" type="file"
             (change)="onFileChange($event)"
             accept=".dcm,.dicom,.jpg,.jpeg,.png"
             class="w-full px-3 py-2 border rounded" />
      <small class="block mt-1 text-xs text-red-600"
             *ngIf="f['fileCtl'].touched && f['fileCtl'].errors?.['required']">
        Debes seleccionar un archivo.
      </small>
      <small class="block mt-1 text-xs text-slate-500">
        Formatos aceptados: DICOM, JPG, PNG.
      </small>
    </div>

    <!-- NOMBRE ARCHIVO (readonly) -->
    <div class="col-span-12 md:col-span-6">
      <label for="nombreArchivo" class="block mb-1 text-sm font-medium text-slate-700">Nombre de archivo</label>
      <input id="nombreArchivo" type="text" pInputText formControlName="nombreArchivo"
             class="w-full px-3 py-2" readonly />
    </div>

    <!-- TAMAÑO (readonly) -->
    <div class="col-span-12 md:col-span-6">
      <label for="tamanoBytes" class="block mb-1 text-sm font-medium text-slate-700">Tamaño (bytes)</label>
      <input id="tamanoBytes" type="text" pInputText formControlName="tamanoBytes"
             class="w-full px-3 py-2" readonly />
    </div>

    <!-- SERIE (requerido si tipo = 'Serie') -->
    <div class="col-span-12 md:col-span-6">
      <label for="serie" class="block mb-1 text-sm font-medium text-slate-700">Serie</label>
      <input id="serie" type="text" pInputText formControlName="serie"
             placeholder="Ej. Serie axial" class="w-full px-3 py-2" />
      <small class="block mt-1 text-xs text-red-600"
             *ngIf="f['serie'].touched && f['serie'].errors?.['required']">
        La serie es requerida cuando el tipo es "Serie".
      </small>
    </div>

    <!-- ORDEN -->
    <div class="col-span-12 md:col-span-6">
      <label for="orden" class="block mb-1 text-sm font-medium text-slate-700">Orden</label>
      <input id="orden" type="number" formControlName="orden" placeholder="Ej. 1"
             class="w-full px-3 py-2" />
      <small class="block mt-1 text-xs text-red-600"
             *ngIf="f['orden'].touched && f['orden'].errors?.['min']">
        El orden debe ser un número positivo.
      </small>
    </div>

    <!-- ACCIONES -->
    <div class="col-span-12">
      <div class="mt-3 flex items-center justify-end gap-2">
        <p-button
          label="Cancelar"
          severity="secondary"
          [size]="'small'"
          type="button"
          (onClick)="cancelar()"
          [disabled]="loading">
        </p-button>

        <p-button
          label="Guardar"
          icon="pi pi-upload"
          [size]="'small'"
          type="submit"
          [disabled]="loading || form.invalid"
          [loading]="loading">
        </p-button>
      </div>
    </div>

  </form>
</div>
