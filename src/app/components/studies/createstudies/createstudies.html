<!-- src/app/components/studies/createstudies/createstudies.html -->

<p-toast></p-toast>

<div class="mx-auto w-full max-w-[880px] rounded-xl bg-white p-4 sm:p-6 shadow-sm">
  <h2 class="mb-4 text-lg font-semibold text-slate-800">Crear Estudio</h2>

  <form [formGroup]="form" (ngSubmit)="submit()" class="grid grid-cols-12 gap-3 text-sm">

    <!-- PACIENTE -->
    <div class="col-span-12 md:col-span-6">
      <label class="block mb-1 text-sm font-medium text-slate-700">Paciente</label>
      <p-select
        formControlName="patient_id"
        [options]="patients"
        optionLabel="label"
        optionValue="value"
        placeholder="Seleccione..."
        class="w-full">
      </p-select>
      <small class="block mt-1 text-xs text-red-600" *ngIf="getError('patient_id')">{{ getError('patient_id') }}</small>
    </div>

    <!-- MODALIDAD -->
    <div class="col-span-12 md:col-span-6">
      <label class="block mb-1 text-sm font-medium text-slate-700">Modalidad</label>
      <p-select
        formControlName="modality_id"
        [options]="modalities"
        optionLabel="label"
        optionValue="value"
        placeholder="Seleccione..."
        class="w-full">
      </p-select>
      <small class="block mt-1 text-xs text-red-600" *ngIf="getError('modality_id')">{{ getError('modality_id') }}</small>
    </div>

    <!-- EQUIPO -->
    <div class="col-span-12 md:col-span-6">
      <label class="block mb-1 text-sm font-medium text-slate-700">Equipo</label>
      <p-select
        formControlName="team_id"
        [options]="teams"
        optionLabel="label"
        optionValue="value"
        placeholder="Seleccione..."
        class="w-full">
      </p-select>
      <small class="block mt-1 text-xs text-red-600" *ngIf="getError('team_id')">{{ getError('team_id') }}</small>
    </div>

    <!-- MÉDICO (opcional) -->
    <div class="col-span-12 md:col-span-6">
      <label class="block mb-1 text-sm font-medium text-slate-700">Médico</label>
      <p-select
        formControlName="medico_id"
        [options]="doctors"
        optionLabel="label"
        optionValue="value"
        placeholder="Seleccione..."
        class="w-full">
      </p-select>
    </div>

    <!-- TECNÓLOGO (opcional) -->
    <div class="col-span-12 md:col-span-6">
      <label class="block mb-1 text-sm font-medium text-slate-700">Tecnólogo</label>
      <p-select
        formControlName="technologist_id"
        [options]="technologists"
        optionLabel="label"
        optionValue="value"
        placeholder="Seleccione..."
        class="w-full">
      </p-select>
    </div>

    <!-- CITA (opcional) -->
    <div class="col-span-12 md:col-span-6">
      <label class="block mb-1 text-sm font-medium text-slate-700">Cita (ID)</label>
      <input pInputText type="number" formControlName="quote_id" class="w-full px-3 py-2" placeholder="ID de la cita">
    </div>

    <!-- FECHA/HORA -->
    <div class="col-span-12 md:col-span-6">
      <label class="block mb-1 text-sm font-medium text-slate-700">Fecha y hora</label>
      <p-datepicker
        formControlName="fechaHora"
        [showTime]="true"
        hourFormat="24"
        appendTo="body"
        inputId="fechaHora"
        class="w-full">
      </p-datepicker>
      <small class="block mt-1 text-xs text-red-600" *ngIf="getError('fechaHora')">{{ getError('fechaHora') }}</small>
    </div>

    <!-- PRIORIDAD -->
    <div class="col-span-12 md:col-span-6">
      <label class="block mb-1 text-sm font-medium text-slate-700">Prioridad</label>
      <p-select
        formControlName="prioridad"
        [options]="prioridadOpts"
        optionLabel="label"
        optionValue="value"
        class="w-full">
      </p-select>
    </div>

    <!-- MOTIVO -->
    <div class="col-span-12">
      <label class="block mb-1 text-sm font-medium text-slate-700">Motivo / Indicación</label>
      <input pInputText formControlName="motivo" class="w-full px-3 py-2" placeholder="Describa el motivo">
      <small class="block mt-1 text-xs text-red-600" *ngIf="getError('motivo')">{{ getError('motivo') }}</small>
    </div>

    <!-- ESTADO -->
    <div class="col-span-12 md:col-span-6">
      <label class="block mb-1 text-sm font-medium text-slate-700">Estado</label>
      <p-select
        formControlName="status"
        [options]="statusOpts"
        optionLabel="label"
        optionValue="value"
        class="w-full">
      </p-select>
    </div>

    <!-- ETIQUETAS -->
    <div class="col-span-12">
      <label class="block mb-1 text-sm font-medium text-slate-700">Etiquetas</label>
      <p-multiSelect
        formControlName="labels"
        [options]="labelsOpt"
        optionLabel="label"
        optionValue="value"
        display="chip"
        defaultLabel="Selecciona etiquetas"
        class="w-full">
      </p-multiSelect>
    </div>

    <!-- ACCIONES -->
    <div class="col-span-12 mt-2 flex gap-2 justify-end">
      <button pButton type="button" label="Cancelar" class="p-button-text" (click)="cancelar()"></button>
      <button pButton type="submit" label="Crear" icon="pi pi-check" [disabled]="loading"></button>
    </div>
  </form>
</div>
