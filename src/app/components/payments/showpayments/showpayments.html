<p-toast></p-toast>
<p-confirmDialog></p-confirmDialog>

<div class="mx-auto w-full max-w-[1100px] p-4 sm:p-6">
  <div class="mb-4 flex items-center justify-between">
    <h2 class="text-lg font-semibold text-slate-800">Pagos</h2>
    <a routerLink="/payments/create" class="p-button p-component">
      <span class="p-button-label">Registrar Pago</span>
    </a>
  </div>

  <p-table
    [value]="(payments$ | async) || []"
    [loading]="(loading$ | async) ?? true"
    dataKey="id"
    class="shadow-sm rounded-xl overflow-hidden"
    [tableStyle]="{ 'min-width': '60rem' }"
    [rowTrackBy]="trackById"
  >
    <ng-template pTemplate="header">
      <tr>
        <th class="text-sm">ID</th>
        <th class="text-sm">Paciente</th>
        <th class="text-sm">Estudio</th>
        <th class="text-sm">Monto</th>
        <th class="text-sm">Método</th>
        <th class="text-sm">Fecha</th>
        <th class="text-sm">Estado</th>
        <th class="text-sm text-right">Acciones</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-row>
      <tr>
        <td class="text-sm">{{ row.id }}</td>
        <td class="text-sm">{{ getPatientName(row.pacienteId) }}</td>
        <td class="text-sm">{{ row.estudioId || '—' }}</td>
        <td class="text-sm">$ {{ row.monto | number:'1.0-0' }}</td>
        <td class="text-sm">{{ row.metodo }}</td>
        <td class="text-sm">{{ row.fecha }}</td>
        <td class="text-sm">
          <p-tag [severity]="colorEstado(row.estado)" [value]="row.estado"></p-tag>
        </td>
        <td class="text-right space-x-1">
          <button
            pButton
            type="button"
            icon="pi pi-pencil"
            class="p-button-rounded p-button-text p-button-warning"
            [routerLink]="['/payments/update', row.id]"
            pTooltip="Editar"
          ></button>


          <button
            pButton
            type="button"
            icon="pi pi-ban"
            class="p-button-rounded p-button-text p-button-secondary"
            (click)="deletePaymentAdv(row)"
            pTooltip="Marcar como VOID"
          ></button>

          <button
            pButton
            type="button"
            icon="pi pi-trash"
            class="p-button-rounded p-button-text p-button-danger"
            (click)="deletePayment(row)"
            pTooltip="Eliminar definitivamente"
          ></button>
        </td>
      </tr>
    </ng-template>

    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="8" class="text-center py-6 text-sm text-slate-500">
          Sin pagos registrados.
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>
